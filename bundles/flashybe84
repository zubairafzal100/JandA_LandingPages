(function(n,t,i,r){"use strict";function h(){this.storage={};this.get=function(n){return n in this.storage?this.storage[n]:null};this.set=function(n,t){this.storage[n]=t};this.del=function(n){delete this.storage[n]};this.len=function(){return Object.keys(this.storage).length}}function c(){this.isMobile=function(n){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(n)};this.transitionEvent=function(){var u=i.createElement("fakeelement"),n={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var t in n)if(u.style[t]!==r)return n[t];return null};this.animationEvent=function(){var u=i.createElement("fakeelement"),n={animation:"animationend",MSAnimationEnd:"msAnimationEnd",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var t in n)if(u.style[t]!==r)return n[t];return null}}function e(){}function s(){return f==null&&(f=new e,f._init()),f}var u="flashy-id",l="flashy-type",a="flashy-href",v="flashy-title",y="flashy-width",p="flashy-height",w=0,o=0,f=null;e.prototype={itemDefaults:{type:"image",title:!0,width:null,height:null,gallery:!0,galleryLoop:!0,galleryCounter:!0,galleryPrevNext:!0,galleryCounterMessage:"[index] / [total]",gallerySwipeDesktop:!0,gallerySwipeMobile:!0,gallerySwipeThreshold:100,keyboard:!0,overlayClose:!1,themeClass:null,showClass:null,hideClass:null,nextShowClass:null,nextHideClass:null,prevShowClass:null,prevHideClass:null,videoAutoPlay:!1,loadError:"Sorry, an error occured while loading the content..."},touchMouseEvent:{down:"touchmousedown",up:"touchmouseup",move:"touchmousemove"},$body:null,$document:null,util:null,animationEvent:null,items:null,currItem:null,prevItem:null,nextItem:null,def:null,swipe:{startY:0,startX:0,endY:0,endX:0,diffY:0,diffX:0,startTouch:!1,threshold:100},controls:{$overlay:null,$container:null,$contentOuter:null,$contentInner:null,$content:null,$title:null,$numeration:null,$next:null,$prev:null,$close:null,$preloader:null},_init:function(){this.$body=n("body");this.$document=n(i);this.util=new c;this.animationEvent=this.util.animationEvent();this.items=new h},_buildDOM:function(){this.controls.$overlay=n("<div><\/div>").addClass("flashy-overlay");this.controls.$container=n("<div><\/div>").addClass("flashy-container").attr("tabindex",1);this.controls.$title=n("<div><\/div>").addClass("flashy-title");this.controls.$numeration=n("<div><\/div>").addClass("flashy-numeration");this.controls.$next=n("<div><\/div>").addClass("flashy-next");this.controls.$prev=n("<div><\/div>").addClass("flashy-prev");this.controls.$close=n("<div>Ã—<\/div>").addClass("flashy-close");this.controls.$preloader=n("<div><\/div>").addClass("flashy-preloader");this.controls.$overlay.append(this.controls.$container,this.controls.$title,this.controls.$numeration,this.controls.$next,this.controls.$prev,this.controls.$close,this.controls.$preloader);this.$body.append(this.controls.$overlay);this.$body.append(n("<div id='object1'><\/div>"));this.$body.get(0).offsetHeight;var t=this.controls.$container.get(0).offsetWidth-this.controls.$container.get(0).clientWidth;this.controls.$container.css("right",-t+"px");this.$body.addClass("flashy-active")},_bind:function(i){if(i.config.overlayClose)this.controls.$overlay.on("click touchend",n.proxy(this._onOverlayClick,this));else this.controls.$close.on("click touchend",n.proxy(this._onCloseClick,this));this.controls.$prev.on("click touchend",n.proxy(this._onGalleryNavigationClick,this,"prev"));this.controls.$next.on("click touchend",n.proxy(this._onGalleryNavigationClick,this,"next"));this.$body.on("keydown",n.proxy(this._onKeyboard,this));if(i.config.gallery)if("ontouchstart"in t){if(i.config.gallerySwipeMobile){this.$document.on("touchstart",n.proxy(this._onTouch,this));this.$document.on("touchmove",n.proxy(this._onTouch,this));this.$document.on("touchend",n.proxy(this._onTouch,this))}}else if(i.config.gallerySwipeDesktop){this.$document.on("mousedown",n.proxy(this._onMouse,this));this.$document.on("mouseup",n.proxy(this._onMouse,this));this.$document.on("mouseout",n.proxy(this._onMouse,this));this.$document.on("mousemove",n.proxy(this._onMouse,this))}this.$document.on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",n.proxy(this._onFullsceenChange,this))},_unbind:function(){this.controls.$overlay.off("click touchend",n.proxy(this._onOverlayClick,this));this.controls.$close.off("click touchend",n.proxy(this._onCloseClick,this));this.controls.$prev.off("click touchend",n.proxy(this._onGalleryNavigationClick,this,"prev"));this.controls.$next.off("click touchend",n.proxy(this._onGalleryNavigationClick,this,"next"));this.$body.off("keydown",n.proxy(this._onKeyboard,this));"ontouchstart"in t?(this.$document.off("touchstart",n.proxy(this._onTouch,this)),this.$document.off("touchmove",n.proxy(this._onTouch,this)),this.$document.off("touchend",n.proxy(this._onTouch,this))):(this.$document.off("mousedown",n.proxy(this._onMouse,this)),this.$document.off("mouseup",n.proxy(this._onMouse,this)),this.$document.off("mouseout",n.proxy(this._onMouse,this)),this.$document.off("mousemove",n.proxy(this._onMouse,this)));this.$document.off("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",n.proxy(this._onFullsceenChange,this))},_addItem:function(t,i,r){var f=t.data(u),e={id:null,$el:t,config:r,group:i,groupIndex:0,groupTotal:0};if(!f){f=w++;t.data(u,f);t.on("click touchend",n.proxy(this._onItemClick,this))}e.id=f;this.items.set(f,e)},_removeItem:function(t){var i=t.data(u);i&&(t.removeData(u),t.off("click touchend",n.proxy(this._onItemClick,this)),this.items.del(i))},_onFullsceenChange:function(){t.screenTop||t.screenY?this.controls.$overlay.addClass("flashy-fullscreen"):this.controls.$overlay.removeClass("flashy-fullscreen")},_onOverlayClick:function(t){var i=n(t.target);i.closest(".flashy-content").hasClass("flashy-content")||this._close()},_onCloseClick:function(){this._close()},_onGalleryNavigationClick:function(n,t){t.preventDefault();t.stopPropagation();this._galleryNavigate(n)},_onKeyboard:function(n){if(this.currItem!=null&&this.currItem.config.keyboard){if(n.keyCode===27){this._close();return}this.currItem.config.gallery&&(n.keyCode==37&&this.prevItem&&this._galleryNavigate("prev"),n.keyCode==39&&this.nextItem&&this._galleryNavigate("next"))}},_onItemClick:function(t){t.preventDefault();t.stopPropagation();this._show(n(t.currentTarget))},_onMouse:function(t){var i,r;switch(t.type){case"mousedown":i=this.touchMouseEvent.down;break;case"mouseup":i=this.touchMouseEvent.up;break;case"mouseout":i=this.touchMouseEvent.up;break;case"mousemove":i=this.touchMouseEvent.move;break;default:return}r=this._normalizeEvent(i,t,t.pageX,t.pageY);n(t.target).trigger(r)},_onTouch:function(t){var i,r,u;switch(t.type){case"touchstart":i=this.touchMouseEvent.down;break;case"touchend":i=this.touchMouseEvent.up;break;case"touchmove":i=this.touchMouseEvent.move;break;default:return}r=t.originalEvent.touches[0];u=i==this.touchMouseEvent.up?this._normalizeEvent(i,t,null,null):this._normalizeEvent(i,t,r.pageX,r.pageY);n(t.target).trigger(u)},_onSwipeDown:function(n){this.swipe.startY=this.swipe.endY=n.pageY;this.swipe.startX=this.swipe.endX=n.pageX;this.swipe.startouch=!0},_onSwipeMove:function(n){if(this.swipe.startouch){this.swipe.endY=n.pageY;this.swipe.endX=n.pageX;this.swipe.diffY=this.swipe.endY-this.swipe.startY;this.swipe.diffX=this.swipe.endX-this.swipe.startX;var t=Math.abs(this.swipe.diffX),i=Math.abs(this.swipe.diffY);(t>=10||i>=10)&&(n.preventDefault(),this.controls.$content.css("transform","translate("+this.swipe.diffX+"px,"+this.swipe.diffY+"px)"))}},_onSwipeUp:function(){if(this.swipe.startouch){this.swipe.startouch=!1;var n=null,t=!1;this.swipe.diff=this.swipe.endX-this.swipe.startX;this.swipe.diff<0&&this.nextItem&&(n="next",t=!0);this.swipe.diff>0&&this.prevItem&&(n="prev",t=!0);t&&Math.abs(this.swipe.diff)>=this.swipe.threshold?this._galleryNavigate(n):this.controls.$content.css("transform","")}},_normalizeEvent:function(t,i,r,u){return n.Event(t,{pageX:r,pageY:u,originalEvent:i})},_show:function(n,t){var o=n.data(u),i=this.items.get(o),f=n.data(l)||i.config.type,e=n.data(a)||n.attr("href"),r=this,s=this._parseVideoUrl(e);s.type||(f="iframe");this.currItem==null&&(this._buildDOM(),this._initGalleryCounter(i),this._bind(i));this._hideContent(this.currItem,t);this.currItem=i;this._loadContent(f,i,e).done(function(){r._showContent(i,t)}).fail(function(){r.controls.$content.html(i.config.loadError).addClass("flashy-error");r._showContent(i,t)}).always(function(){r._updateDOM(i);r._hidePreloader();r._initSwipe(i)})},_close:function(){this.controls.$overlay.remove();this.$body.removeClass("flashy-active");this._unbind();this.currItem&&this.currItem.$el.focus();this.currItem=null;this.controls.$contentOuter=null;this.controls.$contentInner=null;this.controls.$content=null;this._hideGalleryNavigation()},_showPreloader:function(){this.controls.$preloader.addClass("flashy-show")},_hidePreloader:function(){this.controls.$preloader.removeClass("flashy-show")},_initSwipe:function(t){this.swipe.threshold=t.config.gallerySwipeThreshold;this.controls.$contentInner.on(this.touchMouseEvent.down,n.proxy(this._onSwipeDown,this));this.controls.$contentInner.on(this.touchMouseEvent.move,n.proxy(this._onSwipeMove,this));this.controls.$contentInner.on(this.touchMouseEvent.up,n.proxy(this._onSwipeUp,this))},_hideContent:function(t,i){var r,u;if(this.controls.$contentOuter)if(r=this.controls.$contentOuter,this.controls.$contentOuter=null,this.controls.$contentInner=null,this.controls.$content=null,u=t.config.hideClass,i=="next"&&t.config.nextHideClass?u=t.config.nextHideClass:i=="prev"&&t.config.prevHideClass&&(u=t.config.prevHideClass),this.animationEvent&&u){r.attr("class","flashy-content-outer");r.addClass(u);r.one(this.animationEvent,function(){n(this).remove()})}else r.remove()},_showContent:function(n,t){var i=n.config.showClass,r,u;t=="next"&&n.config.nextShowClass?i=n.config.nextShowClass:t=="prev"&&n.config.prevShowClass&&(i=n.config.prevShowClass);this.animationEvent&&i&&this.controls.$contentOuter.addClass(i);this.controls.$container.focus().stop().animate({scrollTop:0},300);this.controls.$content.addClass("flashy-show");this.controls.$content.on("dragstart","img",function(){return!1});r=n.$el.data(y)||n.config.width;u=n.$el.data(p)||n.config.height;r&&this.controls.$content.css("width",r);u&&this.controls.$content.css("height",u)},_loadContent:function(t,i,r){this._showPreloader();this._updateGalleryNavigation(i);this.controls.$contentOuter=n("<div><\/div>").addClass("flashy-content-outer");this.controls.$contentInner=n("<div><\/div>").addClass("flashy-content-inner");this.controls.$content=n("<div><\/div>").addClass("flashy-content");this.controls.$contentInner.append(this.controls.$content);this.controls.$contentOuter.append(this.controls.$contentInner);this.controls.$container.append(this.controls.$contentOuter);this.def&&(this.def.reject(),this.def=null);var u=this.def=n.Deferred();switch(t){case"image":this._loadImage(u,i,r);break;case"inline":this._loadInline(u,i,r);break;case"ajax":this._loadAjax(u,i,r);break;case"iframe":this._loadIframe(u,i,r);break;case"video":this._loadVideo(u,i,r)}return u.promise()},_loadImage:function(t,i,r){this.controls.$content.addClass("flashy-image");this.controls.$content.html('<img src="'+r+'">');var u=this.controls.$content.find("img");u.one("load",function(){t.resolve()}).one("error",function(){t.reject()}).each(function(){this.complete&&n(this).load()})},_loadInline:function(t,i,r){var u=n(r);u.length&&(this.controls.$content.addClass("flashy-inline"),this.controls.$content.html(u.html()),t.resolve());t.reject()},_loadAjax:function(t,i,r){this.controls.$content.addClass("flashy-inline");var u=this;n.ajax({url:r,cache:!1}).done(function(n){u.controls.$content.html(n);t.resolve()}).fail(function(){t.reject()})},_loadIframe:function(n,t,i){this.controls.$content.addClass("flashy-iframe");this.controls.$content.html('<iframe src="'+i+'"><\/iframe>');n.resolve()},_loadVideo:function(n,t,i){this.controls.$content.addClass("flashy-video");var u=this._parseVideoUrl(i),r=null,f=t.config.videoAutoPlay?"?rel=0&autoplay=1":"?rel=0",e=f+this._getUrlParameter(i);u.type=="vimeo"?r="https://player.vimeo.com/video/":u.type=="youtube"&&(r="https://www.youtube.com/embed/");r?(this.controls.$content.html('<iframe webkitallowfullscreen mozallowfullscreen allowfullscreen frameborder="0" src="'+r+u.id+e+'"><\/iframe>'),n.resolve()):n.reject()},_parseVideoUrl:function(n){n.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/);var t;return RegExp.$3.indexOf("youtu")>-1?t="youtube":RegExp.$3.indexOf("vimeo")>-1&&(t="vimeo"),{type:t,id:RegExp.$6}},_getUrlParameter:function(){var i="",e=decodeURIComponent(name),f=e.split("?"),u,n,t;if(f[1]!==r)for(u=f[1].split("&"),n=null,t=0;t<u.length;t++)n=u[t].split("="),i=i+"&"+n[0]+"="+n[1];return encodeURI(i)},_galleryNavigate:function(n){this.currItem!=null&&(n=="next"&&this.nextItem?this._show(this.nextItem.$el,n):n=="prev"&&this.prevItem&&this._show(this.prevItem.$el,n))},_hideGalleryNavigation:function(){this.nextItem=null;this.prevItem=null;this.controls.$next.removeClass("flashy-show");this.controls.$prev.removeClass("flashy-show")},_updateGalleryNavigation:function(n){if(!n.config.gallery){this._hideGalleryNavigation();return}for(var o=this.items.len(),t=null,i=null,f=null,e=null,r=null,u=null,t=0;t<o;t++)if(this.items.storage.hasOwnProperty(t)&&(i=this.items.storage[t],i.group==n.group)){f=i;break}for(t=o-1;t>=0;t--)if(this.items.storage.hasOwnProperty(t)&&(i=this.items.storage[t],i.group==n.group)){e=i;break}for(t=n.id+1;t<o;t++)if(this.items.storage.hasOwnProperty(t)&&(i=this.items.storage[t],i.group==n.group)){r=i;break}for(t=n.id-1;t>=0;t--)if(this.items.storage.hasOwnProperty(t)&&(i=this.items.storage[t],i.group==n.group)){u=i;break}if(f&&e&&f.id==e.id){this._hideGalleryNavigation();return}n.config.galleryLoop&&(r==null&&(r=f),u==null&&(u=e));r&&n.config.galleryPrevNext?this.controls.$next.addClass("flashy-show"):this.controls.$next.removeClass("flashy-show");u&&n.config.galleryPrevNext?this.controls.$prev.addClass("flashy-show"):this.controls.$prev.removeClass("flashy-show");this.nextItem=r;this.prevItem=u},_initGalleryCounter:function(n){for(var i=0,u=0,r=this.items.len(),t=null,t=0;t<r;t++)this.items.storage.hasOwnProperty(t)&&this.items.storage[t].group==n.group&&i++;for(t=0;t<r;t++)this.items.storage.hasOwnProperty(t)&&this.items.storage[t].group==n.group&&(this.items.storage[t].groupIndex=++u,this.items.storage[t].groupTotal=i)},_updateGalleryCounter:function(n){if(n.config.gallery&&n.config.galleryCounter&&n.config.galleryCounterMessage&&n.groupTotal>1){var t=n.config.galleryCounterMessage.replace("[index]",n.groupIndex).replace("[total]",n.groupTotal);this.controls.$numeration.addClass("flashy-show").text(t)}else this.controls.$numeration.removeClass("flashy-show")},_updateTitle:function(n){if(n.config.title){var t=n.$el.data(v)||n.$el.attr("title");t?this.controls.$title.addClass("flashy-show").html(t):this.controls.$title.removeClass("flashy-show")}else this.controls.$title.removeClass("flashy-show")},_updateDOM:function(n){this._updateTitle(n);this._updateGalleryCounter(n);this.controls.$overlay.attr("class","flashy-overlay");n.config.themeClass&&this.controls.$overlay.addClass(n.config.themeClass)},show:function(n){this._show(n)},close:function(){this._close()}};n.fn.flashy=function(t){return t=="instance"?s():(o++,this.each(function(){var i=s(),r=n(this),u=o,f=n.isPlainObject(t)?t:{},h=n.extend(!0,{},e.prototype.itemDefaults,f);i._addItem(r,u,h)}))}})(jQuery,window,document)